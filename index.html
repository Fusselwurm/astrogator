<html>
<head>
	<title>astrogat0r</title>
	<script type="text/javascript"
		src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
	<script type="text/javascript" src="./vector.js"></script>
	<script type="text/javascript" src="./lib.js"></script>
	<script type="text/javascript" src="./test.js"></script>
	<style type="text/css">
		canvas {
			border: 5px solid black;
		}
	</style>
</head>
<body>
<h1>buttons</h1>
<button id="btnClear">clear</button>
<button id="btnStop">stop</button>
<button id="btnGo">go</button>
<label for="inpScale">scale (e10)</label><input id="inpScale" type="range"
						min="-22" max="22"
						value="0"/><span
    id="inpScaleShow"></span>

<h2>canvas</h2>

<canvas id="space" width="500" height="500"></canvas>

<script type="text/javascript">

	var cnvs = document.getElementById('space');
	var ctx = cnvs.getContext('2d');
	ctx.fillStyle = "rgba(255, 255, 0, 1)";

	var scale = 1e-10;
	move.onChange((function () {
		//var cnt = {};
		return function (body) {
			/*		cnt[body.name] = (cnt[body.name] || 0) + 1;
			 if (cnt[body.name] % 5) {
			 return;
			 }*/

			var
			    posTranslated = body.position.map(function (v) {
				    return (v * scale) + 250;
			    }),
			    getColor = function (b) {
				    return [
					    b.mass % 255,
					    (b.name.charCodeAt(0) + b.name.charCodeAt(1)) % 255,
					    b.vector.norm() / 255
				    ].map(function (n) {
					    return Math.floor(n);
				    });
			    },
			    c = getColor(body);

			ctx.fillStyle = "rgba(" + c.join(',') + ", 1)";

			ctx.fillRect(posTranslated[0], posTranslated[1], 2, 2);
		};
	}()));

</script>

<script type="text/javascript">

	var tick = 0,

	    bodies = (function () {
		    var s = ASTROGATOR.systems.sol,
			bodies = [
				{
					name: s[0].name,
					mass: s[0].mass,
					position: new Vector([0, 0, 0]),
					vector: new Vector([0, 0, 0])
				}
			];

		    return bodies.concat(s.slice(1).map(function (planet, i) {
			    var
				dist = (planet.periapsis + planet.apoapsis) / 2,
				position,
				vector;

			    if (planet.orbital_reference === 'Sol') {
				    position = new Vector(i % 2 ? [-dist, 0, 0] : [dist, 0, 0]);
				    vector = new Vector(i % 2 ? [0, planet.average_orbital_velocity, 0]: [0, -planet.average_orbital_velocity, 0]);
			    } else {
				   return;
			    }

			    return {
				    mass: planet.mass,
				    name: planet.name,
				    // ok this is stupid, should distribute planets smart
				    position: position,
				    vector: vector
			    };
		    }));
	    }());


	$(document).ready(function () {
		$('#btnGo').click(function () {
			tick = setInterval(function () {
				move(bodies, 1000);
			}, 0);
		});
		$('#btnStop').click(function () {
			clearInterval(tick);
		});
		$('#btnClear').click(function () {
			ctx.clearRect(0, 0, 500, 500);
		});


		$('#inpScale').change(function () {
			scale = Math.pow(10, this.value);
			ctx.clearRect(0, 0, 500, 500);
			$('#inpScaleShow').text(scale);

		}).attr('value', Math.round(Math.log(scale) / Math.LN10));



		setInterval(function () {
			ctx.fillStyle = "rgba(255, 255, 255, 0.05)";
			ctx.fillRect(0, 0, 500, 500);
		}, 1000);
	});
</script>
</body>
</html>
